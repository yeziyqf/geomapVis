<html>
<head>
  <meta charset=utf-8 />
  <title>GeomapVis</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>


    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.1.3/dist/esri-leaflet.js"
    integrity="sha512-pijLQd2FbV/7+Jwa86Mk3ACxnasfIMzJRrIlVQsuPKPCfUBCDMDUoLiBQRg7dAQY6D1rkmCcR8286hVTn/wlIg=="
    crossorigin=""></script>


  <style>
    body { margin:0; padding:0; }
    #map { position: absolute; top:0; bottom:0; right:0; left:0; }

    /* css to customize Leaflet default styles  */
    .custom .leaflet-popup-tip,
    .custom .leaflet-popup-content-wrapper {
        background: #ffffff;
        color: #ffffff;
        width:auto !important;
        height: auto !important;
    }

    /*Customize popup image style.(not in use)*/
    .popupImage {
        max-width: 20%;
        max-height: 20%;
    }
    .leaflet-popup-content {
        width:auto !important;
    }

  </style>
</head>
<body>

<link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.Default.css">
<link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.css">
<script src="https://unpkg.com/leaflet.markercluster@1.0.4/dist/leaflet.markercluster.js"></script>

<!-- Load Clustered Feature Layer from CDN -->
<script src="https://unpkg.com/esri-leaflet-cluster@2.0.0"></script>

<div id="map"></div>

<script>
  var map = L.map('map').setView([45.526, -122.667], 15); 

  L.esri.basemapLayer('Streets').addTo(map);

  //  (new constructor syntax at 2.0.0)
  var trees = L.esri.Cluster.featureLayer({
    url: 'https://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/Trimet_Transit_Stops/FeatureServer/0'
  }).addTo(map);

  // // Image Service added.
  // L.esri.imageMapLayer({
  //     url: 'https://landsat.arcgis.com/arcgis/rest/services/Landsat/PS/ImageServer',
  //     attribution: 'United States Geological Survey (USGS), National Aeronautics and Space Administration (NASA)'
  //   }).addTo(map);

//   L.polygon([
//  [45.526, -122.667],
//  [45, -122.66],
//  [45.5, -122.6],
//  [45.52, -122]
// ]).addTo(map).bindPopup("故宫");　

/*
  //Show popups on map
  var popup = L.popup();

  var photoImg = '<img src="https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/1.png?alt=media&token=e7836e50-a6bd-40db-89d0-d4e7b73919a0" height="150px" maxWidth: "auto"/>';

  function onMapClick(e) {
      popup
          .setLatLng(e.latlng)
          .setContent("<center>My Photo </center>" + "</br>"+ photoImg)
          .openOn(map);
  }
  map.on('click', onMapClick);
*/

    //Another option
    var photoIcon = L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.3.1/dist/images/marker-icon.png',
        iconSize: [26, 41], // size of the icon
        popupAnchor: [0,-15]
    });
    // create popup contents
    var imgsource = 'https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/1.png?alt=media&token=e7836e50-a6bd-40db-89d0-d4e7b73919a0';
    // var customPopup = new Array(15);

    function randomImg() {
        var r = getRandomIntInclusive();
        switch(r) {
          case 0:
              return customPopup0;
              break;
          case 1:
              return customPopup1;
              break;
          case 2:
              return customPopup2;
              break;
          case 3:
              return customPopup3;
              break;
          case 4:
              return customPopup4;
              break;
          case 5:
              return customPopup5;
              break;
          default:
              return customPopup6;
        }
        // return imgSuffixes[r]
    }

    function getRandomIntInclusive() {
      var min = 0, max =9;
      var result = Math.floor(Math.random() * (max - min + 1)) + min;
      console.log(result);
      return result;
    }

    var customPopup0 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/1.png?alt=media&token=e7836e50-a6bd-40db-89d0-d4e7b73919a0' 'width': '50','height': '50'/>";
    var customPopup1 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/2.png?alt=media&token=4013c584-2555-49f0-bacf-aa7d5d62f1bd' 'width': '50','height': '50'/>";
    var customPopup2 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/3.png?alt=media&token=9341ea02-1038-4d67-b87d-0d8a12238ff2' 'width': '50','height': '50'/>";
    var customPopup3 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/4.png?alt=media&token=9276e25a-d6d0-4598-bbbf-69317706c46c' 'width': '50','height': '50'/>";
    var customPopup4 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/5.png?alt=media&token=d881d777-970d-4f72-8472-4b8bcc1e23a4' 'width': '50','height': '50'/>";
    var customPopup5 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/6.png?alt=media&token=bf8acb77-9f55-4320-b826-0243726bc92c' 'width': '50','height': '50'/>";
    var customPopup6 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/7.png?alt=media&token=7de8848c-9c88-4f85-a747-4e050e13d718' 'width': '50','height': '50'/>";
    var customPopup7 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/8.png?alt=media&token=a4b82c4b-418b-4934-97be-62695d8e0e70' 'width': '50','height': '50'/>";
    var customPopup8 = "Local images<br/><img src='https://firebasestorage.googleapis.com/v0/b/geomapvis.appspot.com/o/9.png?alt=media&token=679a468f-5fd2-4489-ab8f-7983932c934b' 'width': '50','height': '50'/>";


    // specify popup options 
    var customOptions =
        {
        // 'maxWidth': '50',
        // 'maxHeight': '50',
        'className' : 'custom'
        }
    
    // create marker object, pass custom icon as option, pass content and options to popup, add to map
    L.marker([45.526, -122.667], {icon: photoIcon}).bindPopup(randomImg(),customOptions).addTo(map);

  //   trees.bindPopup(function (layer) {
  //   return L.Util.template('<p>{COMMON_NAM}<br>{SCIENTIFIC}<br>{NOTES}</p>', layer.feature.properties);
  // });

    // trees.bindPopup(function (layer) {
    //     return L.Util.template('<p>{COMMON_NAM}<br>{SCIENTIFIC}<br>{NOTES}</p>', layer.feature.properties);
    // });
    trees.bindPopup(randomImg(),customOptions);
    function onMapClick(e) {
        // randomImg();
        trees.bindPopup(randomImg(),customOptions);
    }
    map.on('click', onMapClick);
    trees.on('click', onMapClick);

</script>

</body>
</html>